# Проект 2: Şañıraq.kz

## MVP объявлений

Продукт **"Şañıraq.kz"** - перспективный маркетплейс жилых помещений Казахстана.

На данном спринте мы начнем разрабатывать наш первый **MVP (Minimum Valuable Product)** данного сервиса. Мы сфокусируемся на трех аспектах нашего маркетплейса - пользователи, объявления и комментарии:

- **Пользователи** должны иметь возможность указывать свои персональные данные, чтобы клиенты могли связаться с ними.
- **Объявления** - это главная ценность продукта. Пользователи должны иметь возможность создавать, изменять, удалять и получать свои объявления.
- **Комментарии к объявлениям.** Клиенты сервиса должны иметь возможность писать комментарий к объявлениям, чтобы оставлять свои отзывы.

### Базовые требования к проекту:

- Использовать базу данных **SQLite**.
- Наличие **миграции** для таблиц.
- Использовать **OAuth2PasswordBearer** для авторизации.

---

## ✅ Таск №1: Регистрация

Наши пользователи могут смотреть и создавать объявления. Поэтому важно, чтобы пользователи знали, кто автор объявления. Для этого нам нужно добавить регистрацию на сайт.

Пример запроса на API:

```http
POST /auth/users/ HTTP/1.1
Content-Type: application/json

{
    "username": "test@gmail.com",
    "phone": "+7 700 698 5025",
    "password": "12345678",
    "name": "Далида Е.",
    "city": "Алматы"
}
```

При успешном создании, API должен возвращать **HTTP 200 OK**.

```http
HTTP/1.1 200 OK
```

---

## ✅ Таск №2: Логин

Для того чтобы пользователи могли пользоваться сайтом, им нужно быть авторизованными. Создайте маршрут для входа в платформу.

Пример запроса на API:

```http
POST /auth/users/login HTTP/1.1
Content-Type: application/x-www-form-urlencoded

username=test@gmail.com&password=12345678
```

При успешном создании, API должен возвращать **HTTP 200 OK** и **JWT токен**:

```http
HTTP/1.1 200 OK
{
    "access_token": "<jwt_token>"
}
```

---

## ✅ Таск №3: Изменение данных пользователя

Нужно иметь возможность авторизованному пользователю изменить свои персональные данные. 

Аутентификация происходит через заголовок **Authorization**, где **{token}** - токен авторизованного пользователя.

Ниже приведен пример запроса на API. Должен выполняться HTTP метод **PATCH** на роут **/auth/users/me**, в который передается JSON структура. Переданные данные должны сохраняться пользователю, который делает запрос.

Чтобы узнать какой пользователь, нужно извлечь id пользователя из токена.

Пример запроса на API:

```http
PATCH /auth/users/me HTTP/1.1
Authorization: Bearer {token}

{
    "phone": "+7 700 698 5025",
    "name": "Далида Е.",
    "city": "Алматы"
}
```

При успешном сохранении, API должен возвращать **HTTP 200 OK**.

```http
HTTP/1.1 200 OK
```

---

## ✅ Таск №4: Получение данных пользователя

Нужно предоставить возможность авторизованному пользователю получать свои персональные данные.


Пример запроса на API: должен выполняться HTTP метод **GET** на роут **/auth/users/me**.

Аутентификация происходит через заголовок **Authorization**, где **{token}** - токен авторизованного пользователя.

```http
GET /auth/users/me HTTP/1.1
Authorization: Bearer {token}
```

При успешном выполнении запроса, API должен возвращать HTTP код **200**, а в теле ответа JSON структура с данными пользователя:

```http
HTTP/1.1 200 OK
{
    "id": "{user_id}",
    "username": "{почта текущего пользователя}",
    "phone": "+7 700 698 5025",
    "name": "Далида Е.",
    "city": "Алматы"
}
```

---

## ✅ Таск №5: Создание объявления

Важно, чтобы созданное объявление закреплялось за пользователем.
Пример запроса на API: должен выполняться HTTP метод **POST** на роут **/shanyraks/**, в который передается JSON структура с данными объявления.

```http
POST /shanyraks/ HTTP/1.1
Authorization: Bearer {token}

{
    "type": "rent",
    "price": 150000,
    "address": "Астана, Алматы р-н, ул. Нажимеденова, 16 – Сарыколь",
    "area": 46.5,
    "rooms_count": 2,
    "description": "Продается 1.5 комнатная квартира. ЖК расположен на правом берегу, не далеко от левого берега.\\nДом расположен в хорошей локации. Рядом находятся мечеть Хазрет Султан, Пирамида, аллея тысячелетия, и многое другое.\\nдвор закрытый, садик во дворе дома, школы в пешей доступности"
}
```

При успешном создании объявления, API должен возвращать **HTTP** код **200** и **id** нового объявления.

```http
HTTP/1.1 200 OK
{
    "id": "1"
}
```

---

## ✅ Таск №6: Получение объявления

```http
GET /shanyraks/{id} HTTP/1.1
```

Ответ:

```http
HTTP/1.1 200 OK
{
    "id": "1",
    "type": "rent",
    "price": 150000,
    "address": "Астана, Алматы р-н, ул. Нажимеденова, 16 – Сарыколь",
    "area": 46.5,
    "rooms_count": 2,
    "description": "Продается 1.5 комнатная квартира...",
    "user_id": "{user_id}"
}
```

---

## ✅ Таск №7: Изменение объявления

Пользователи должны иметь возможность изменять данные своих объявлений.

Пример запроса на API: должен выполняться HTTP метод PATCH на роут **/shanyraks/{id}**, в который передается JSON структура с новыми данными объявления. 

**{id}** - идентификатор объявления.

```http
PATCH /shanyraks/{id} HTTP/1.1
Authorization: Bearer {token}

{
    "type": "rent",
    "price": 250000,
    "address": "Астана, Алматы р-н, ул. Нажимеденова, 17",
    "area": 38.5,
    "rooms_count": 2,
    "description": "СРОЧНО!!!\\nПродается 1.5 комнатная квартира. ЖК расположен на правом берегу, не далеко от левого берега.\\nДом расположен в хорошей локации. Рядом находятся мечеть Хазрет Султан, Пирамида, аллея тысячелетия, и многое другое.\\nдвор закрытый, садик во дворе дома, школы в пешей доступности"
}
```

Ответ:

```http
HTTP/1.1 200 OK
```

---

## ✅ Таск №8: Удаление объявления

```http
DELETE /shanyraks/{id} HTTP/1.1
Authorization: Bearer {token}
```

Ответ:

```http
HTTP/1.1 200 OK
```

---

## ✅ Таск №9-12: Комментарии

### Добавление комментария

```http
POST /shanyraks/{id}/comments HTTP/1.1
Authorization: Bearer {token}

{
"content": "Очень понравилось тут жить! Соседи тихие, автобусные остановки рядом, школа рядом. Дети довольны! ��"
}
```

Ответ:

```http
HTTP/1.1 200 OK
```

### Получение списка комментариев

```http
GET /shanyraks/{id}/comments HTTP/1.1

{
    "comments": [
        {
            "id": "{comment_id}",
            "content": "Очень понравилось тут жить! Соседи тихие, автобусные остановки рядом, школа рядом. Дети довольны! ��",
            "created_at": "{время и дата создания}",
            "author_id": "{user_id пользователя который оставил коммент}"
        },
        {
            "id": "{comment_id}",
            "content": "Очень шумный двор! ��\\nКуча детей играют в футбол до поздна! Много посуточных квартир, поэтому всю ночь ходят пьянные парочки. Везде мусор кидают дети",
            "created_at": "{время и дата создания}",
            "author_id": "{user_id пользователя который оставил коммент}"
        }
    ]
}
```

### Изменение комментария

```http
PATCH /shanyraks/{id}/comments/{comment_id} HTTP/1.1
Authorization: Bearer {token}

{
    "content": "Обновленный текст комментария."
}
```

### Удаление комментария

```http
DELETE /shanyraks/{id}/comments/{comment_id} HTTP/1.1
Authorization: Bearer {token}
```

---

## ✅ Таск №13: Получение объявления с количеством комментариев

При получении детальной информации об объявлении, было бы полезно знать сколько комментариев содержится в объявлении. Пример запроса на API: должен выполняться HTTP метод **GET** на роут **/shanyraks/{id}**, где **{id}** - идентификатор объявления.

```http
GET /shanyraks/{id} HTTP/1.1
```

При успешном выполнении запроса, API должен возвращать HTTP код 200 и JSON структуру с данными объявления.

```http
HTTP/1.1 200 OK
{
    "type": "rent",
    "price": 150000,
    "address": "Астана, Алматы р-н, ул. Нажимеденова, 16 – Сарыколь",
    "area": 46.5,
    "rooms_count": 2,
    "description": "Продается 1.5 комнатная квартира. ЖК расположен на правом берегу, не далеко от левого берега.\\nДом расположен в хорошей локации. Рядом находятся мечеть Хазрет Султан, Пирамида, аллея тысячелетия, и многое другое.\\nдвор закрытый, садик во дворе дома, школы в пешей доступности"
    "user_id": "{user_id пользователя создавшего объявление}"
    "total_comments": 12 <---- новое поле
}
```

---

## ✅ Таск №14: Deploy

Разверните приложение на одном из хостинг-провайдеров:

- [AWS](https://aws.com)
- [Railway](https://railway.app)
- [Render](https://render.com)

