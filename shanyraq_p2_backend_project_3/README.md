# Проект 3: Şañıraq.kz p.2

## MVP объявлений

Проект "Şañıraq.kz" стремится стать лидером на рынке недвижимости, обеспечивая пользователям простой и удобный доступ к объявлениям.

На данном спринте мы поработаем над добавлением новой фичи и также возьмем пару задач из беклога:

- **Избранные объявления**. Пользователи должны иметь возможность сохранить некоторые объявления, чтобы вернуться к ним позже.
- **Разработка списка объявлений**: пользователи смогут легко просматривать все доступные предложения.
- **Поиск и фильтрация объявлений**: будут созданы инструменты для быстрого нахождения нужных объявлений.

## Базовые требования к проекту

- Использовать базу данных `sqlite`
- Наличие миграции для таблиц
- Использовать `OAuth2PasswordBearer` для авторизации

---

## ✅ Таск №1: Ошибка аутентификации

Приведите наши текущие маршруты в соответствие с протоколом HTTP в части аутентификации:

```
PATCH /auth/users/me
GET /auth/users/me
POST /shanyraks/
PATCH /shanyraks/{id}
DELETE /shanyraks/{id}
POST /shanyraks/{id}/comments
PATCH /shanyraks/{id}/comments/{comment_id}
DELETE /shanyraks/{id}/comments/{comment_id}
```

Маршрут, который требует аутентификации, должен возвращать соответствующее сообщение об ошибке. Пример, делается запрос без авторизации:

```
GET /auth/users/me HTTP/1.1
```

Ответ:

```
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Bearer
```

---

## ✅ Таск №2: Права на изменение и удаление постов

Пользователи должны иметь право на изменение и удаление только тех постов, которые они создали.

Измените маршруты:

```
PATCH /shanyraks/{id}
DELETE /shanyraks/{id}
```

Пример:

```
DELETE /shanyraks/{id} HTTP/1.1
Authorization: Bearer <token not author>
```

Ответ:

```
HTTP/1.1 403 Forbidden
```

---

## ✅ Таск №3: Права на изменение и удаление комментариев

Пользователи должны иметь право на изменение и удаление только своих комментариев. Также автор поста должен иметь возможность удалять комментарии.

Измените маршруты:

```
PATCH /shanyraks/{id}/comments/{comment_id}
DELETE /shanyraks/{id}/comments/{comment_id}
```

Пример:

```
DELETE /shanyraks/{id}/comments/{comment_id} HTTP/1.1
Authorization: Bearer <token not author>
```

Ответ:

```
HTTP/1.1 403 Forbidden
```

---

## ✅ Таск №4: Добавление в избранное

Пользователи должны иметь возможность добавлять объявления в избранное:

```
POST /auth/users/favorites/shanyraks/{id} HTTP/1.1
Authorization: Bearer {token}
```

Ответ:

```
HTTP/1.1 200 OK
```

---

## ✅ Таск №5: Получение списка избранных

Пользователи должны иметь возможность просматривать список избранных:

```
GET /auth/users/favorites/shanyraks HTTP/1.1
Authorization: Bearer {token}
```

Ответ:

```json
HTTP/1.1 200 OK
{
  "shanyraks": [
    {
      "_id": "{shanyrak_id1}",
      "address": "Астана, Алматы р-н, ул. Нажимеденова, 16 – Сарыколь"
    },
    {
      "_id": "{shanyrak_id2}",
      "address": "{address2}"
    }
    "..."
  ]
}
```

---

## ✅ Таск №6: Удаление из избранного

Пользователь должен иметь возможность удалить объявление из списка избранных:

```
DELETE /auth/users/favorites/shanyraks/{id} HTTP/1.1
Authorization: Bearer {token}
```

Ответ:

```
HTTP/1.1 200 OK
```

---

## ✅ Таск №7: Поиск и пагинация

Нужно реализовать поиск и пагинацию по объявлениям.

### Поддерживаемые параметры запроса:

| Параметр     | Описание                                       |
|--------------|------------------------------------------------|
| `limit`      | Кол-во записей для отображения на странице     |
| `offset`     | Точка начала отображения в наборе данных       |
| `type`       | Тип объявления - `sell` или `rent`             |
| `rooms_count`| Кол-во комнат                                   |
| `price_from` | Стоимость от                                    |
| `price_until`| Стоимость до                                    |

Каждый параметр, кроме `limit` и `offset`, — опциональный. Если параметры не указаны, роут возвращает все объявления. Объявления сортируются по убыванию даты создания.

### Поля в каждом объявлении:

- `id`
- `type`
- `price`
- `address`
- `area`
- `rooms_count`

### Пример запроса:

```
GET /shanyraks?limit=2&offset=0&rooms_count=2 HTTP/1.1
```

### Пример ответа:

```json
HTTP/1.1 200 OK
{
  "total": 119,
  "objects": [
    {
      "_id": "507f191e810c19729de860ea",
      "type": "rent",
      "price": 150000,
      "address": "Астана, Алматы р-н, ул. Нажимеденова, 16 – Сарыколь",
      "area": 46.5,
      "rooms_count": 2
    },
    {
      "_id": "{shanyrak_id2}",
      "type": "sell",
      "price": 30000000,
      "address": "{address}",
      "area": 86.0,
      "rooms_count": 2
    }
  ]
}
```